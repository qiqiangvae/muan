
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../%E5%B7%A5%E5%85%B7%E7%B1%BB/30.%E6%97%B6%E9%97%B4%E8%BD%AC%E6%8D%A2%E5%B7%A5%E5%85%B7%E7%B1%BB/">
      
      
        <link rel="next" href="../20.ArrayBlockingQueue%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.45">
    
    
      
        <title>造火箭从synchronized开始 - 作草分茶</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#synchronized" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="作草分茶" class="md-header__button md-logo" aria-label="作草分茶" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            作草分茶
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              造火箭从synchronized开始
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  Java

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Linux/20.Linux%E4%B8%8B%E9%80%9A%E7%94%A8jar%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC/" class="md-tabs__link">
          
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="md-tabs__link">
          
  
  中间件

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/" class="md-tabs__link">
          
  
  前沿技术

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%8D%9A%E5%AE%A2/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/1.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6/" class="md-tabs__link">
          
  
  博客

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/1.%E5%BC%80%E5%8F%91%E8%BD%AF%E4%BB%B6%E5%92%8C%E9%85%8D%E7%BD%AE%E5%88%86%E4%BA%AB/" class="md-tabs__link">
          
  
  开发技术

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="作草分茶" class="md-nav__button md-logo" aria-label="作草分茶" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    作草分茶
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Java
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java 基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    JVM
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            JVM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../JVM/Jvm%E8%B0%83%E4%BC%98%E6%80%BB%E7%BB%93/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jvm 调优总结
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../JVM/NIO%E6%B5%8B%E8%AF%95%E5%A0%86%E5%86%85%E5%86%85%E5%AD%98%E5%92%8C%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NIO 测试堆内内存和直接内存
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    工具使用
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            工具使用
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/10.Arthas%E7%BA%BF%E4%B8%8A%E6%8E%92%E6%9F%A5%E7%BB%8F%E9%AA%8C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arthas线上排查经验
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    工具类
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            工具类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B7%A5%E5%85%B7%E7%B1%BB/10.%E6%99%BA%E8%83%BD%E6%97%A5%E6%9C%9F%E8%AF%86%E5%88%AB%E5%B7%A5%E5%85%B7%E7%B1%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    智能日期识别工具类
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%B7%A5%E5%85%B7%E7%B1%BB/30.%E6%97%B6%E9%97%B4%E8%BD%AC%E6%8D%A2%E5%B7%A5%E5%85%B7%E7%B1%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    时间转换工具类
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" checked>
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    并发
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            并发
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    造火箭从synchronized开始
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    造火箭从synchronized开始
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#synchronized_1" class="md-nav__link">
    <span class="md-ellipsis">
      synchronized 原理和对象头
    </span>
  </a>
  
    <nav class="md-nav" aria-label="synchronized 原理和对象头">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      对象头长什么样子
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      升级过程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      抛出的问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="抛出的问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hashcode" class="md-nav__link">
    <span class="md-ellipsis">
      hashcode 是不是真的在对象头中
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      初始状态是什么？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      单线程加锁过后是什么样子？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      交替获取锁升级轻量级锁
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      线程竞争真的会升级为重量级锁吗
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objectmonitor" class="md-nav__link">
    <span class="md-ellipsis">
      ObjectMonitor 监视器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ObjectMonitor 监视器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aqs-fifo-synchronized" class="md-nav__link">
    <span class="md-ellipsis">
      AQS 队列是 FIFO，那 synchronized 的队列呢？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notify-notifyall" class="md-nav__link">
    <span class="md-ellipsis">
      超出认知的 notify 和 notifyAll
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      参考文档
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../20.ArrayBlockingQueue%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ArrayBlockingQueue 阻塞队列
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    编码
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            编码
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E7%BC%96%E7%A0%81/10.Java%E5%B8%B8%E7%94%A8%E7%BC%96%E7%A0%81%E6%8A%80%E5%B7%A7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java常用编码技巧
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    网络
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            网络
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E7%BD%91%E7%BB%9C/Java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%9A%84%E6%BC%94%E8%BF%9B%E5%8F%B2%E5%92%8Cepoll/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java 网络编程的演进史和 epoll
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/20.Linux%E4%B8%8B%E9%80%9A%E7%94%A8jar%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux 下通用 jar 启动脚本
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    命令
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            命令
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Linux/%E5%91%BD%E4%BB%A4/10.Linux%E7%AE%80%E5%8D%95%E6%9C%89%E8%B6%A3%E7%9A%84%E5%91%BD%E4%BB%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux 简单有趣的命令
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    中间件
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            中间件
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    中间件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Clickhouse
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Clickhouse
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/clickhouse/10.ClickHouse%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ClickHouse 入门教程
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Grafana
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Grafana
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/grafana/Grafana%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grafana 安装及使用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mysql
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Mysql
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/mysql/10.Mysql-next-key-lock%E5%8A%A0%E9%94%81%E8%A7%84%E5%88%99/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mysql next-key lock加锁规则
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/mysql/20.Mysql%E5%AE%89%E8%A3%85%E6%80%BB%E7%BB%93%E6%95%99%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mysql 安装总结教程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/mysql/30.%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%ADmysql%E6%AD%BB%E9%94%81%E6%8E%92%E6%9F%A5%E6%B1%87%E6%80%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    开发过程中mysql死锁排查汇总
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/mysql/40.Mysql%E4%B8%80%E4%BA%9B%E5%91%BD%E4%BB%A4%E5%92%8Csql%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mysql 一些命令和sql记录
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Nginx
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Nginx
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/10.nginx%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nginx入门教程
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_6" >
        
          
          <label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Prometheus
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Prometheus
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/prometheus/Prometheus-PromQL%E8%AF%AD%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prometheus PromQL 语法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/prometheus/Prometheus%E5%85%A5%E9%97%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prometheus入门
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_7" >
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Redis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Redis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/10.%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E6%90%9E%E6%87%82Redis%E4%BB%8E%E9%9D%A2%E8%AF%95%E5%88%B0%E5%BA%94%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    一篇文章搞懂 Redis 从面试到应用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    前沿技术
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            前沿技术
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    前沿技术
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Llm
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Llm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/llm/%2010.%E6%9C%AC%E5%9C%B0%E4%BD%BF%E7%94%A8OLLAMA%E6%90%AD%E5%BB%BA%E5%A4%A7%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    本地使用OLLAMA搭建大模型
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    云原生
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            云原生
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/%E4%BA%91%E5%8E%9F%E7%94%9F/1.docker%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    docker 基本使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/%E4%BA%91%E5%8E%9F%E7%94%9F/10.k8s-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k8s 常用命令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/%E4%BA%91%E5%8E%9F%E7%94%9F/2.docker%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    docker 代理服务器配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/%E4%BA%91%E5%8E%9F%E7%94%9F/20.k8s%E4%B9%8BJob%E4%B8%8ECronJob/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k8s之Job与CronJob
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/%E4%BA%91%E5%8E%9F%E7%94%9F/30.Macos-minikube/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Macos-minikube
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/%E4%BA%91%E5%8E%9F%E7%94%9F/50.Ubuntu%E4%BD%BF%E7%94%A8kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ubuntu使用kubeadm安装k8s集群
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/%E4%BA%91%E5%8E%9F%E7%94%9F/60.%E6%8E%A2%E7%B4%A2k8s%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    探索k8s过程中的问题和解决方案
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/%E4%BA%91%E5%8E%9F%E7%94%9F/70.k8s%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k8s持久化存储
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/%E4%BA%91%E5%8E%9F%E7%94%9F/80.k8s%E4%BD%BF%E7%94%A8StatefulSet%E6%90%AD%E5%BB%BARedis%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k8s 使用 StatefulSet 搭建 Redis 主从模式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/%E4%BA%91%E5%8E%9F%E7%94%9F/90.K8s%E9%83%A8%E7%BD%B2%E5%8D%95%E6%9C%BAMysql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K8s部署单机Mysql
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    博客
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            博客
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    系统架构
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            系统架构
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8D%9A%E5%AE%A2/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/1.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A1%AC%E4%BB%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    计算机硬件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8D%9A%E5%AE%A2/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/2.%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    操作系统
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8D%9A%E5%AE%A2/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/3.%E6%95%B0%E6%8D%AE%E5%BA%93/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    数据库
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8D%9A%E5%AE%A2/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/4.%E5%B5%8C%E5%85%A5%E5%BC%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    嵌入式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8D%9A%E5%AE%A2/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/5.%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    计算机网络
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8D%9A%E5%AE%A2/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/6.%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE%E4%B8%8E%E6%80%A7%E8%83%BD%E8%AF%84%E4%BB%B7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    系统配置与性能评价
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%8D%9A%E5%AE%A2/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/7.%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    信息系统基础知识
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    开发技术
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            开发技术
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/1.%E5%BC%80%E5%8F%91%E8%BD%AF%E4%BB%B6%E5%92%8C%E9%85%8D%E7%BD%AE%E5%88%86%E4%BA%AB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    开发软件和配置分享
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/10.%E4%BD%8D%E8%BF%90%E7%AE%97%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    位运算基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/30.Git%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git 常用操作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/40.%E6%89%8B%E5%86%99%E5%B8%B8%E7%94%A8%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AE%97%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    手写常用的负载均衡算法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/50.HTTP%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AE%B0%E5%BD%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP相关知识点记录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/60.Python%E7%AE%80%E5%8D%95%E5%B0%8F%E5%8A%9F%E8%83%BDCoding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Python简单小功能Coding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF/70.%E6%8E%A2%E7%B4%A2java%E4%B8%AD%E5%A4%8D%E6%9D%82%E7%9A%84%E6%97%B6%E5%8C%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    探索java中复杂的时区
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#synchronized_1" class="md-nav__link">
    <span class="md-ellipsis">
      synchronized 原理和对象头
    </span>
  </a>
  
    <nav class="md-nav" aria-label="synchronized 原理和对象头">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      对象头长什么样子
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      升级过程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      抛出的问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="抛出的问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hashcode" class="md-nav__link">
    <span class="md-ellipsis">
      hashcode 是不是真的在对象头中
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      初始状态是什么？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      单线程加锁过后是什么样子？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      交替获取锁升级轻量级锁
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      线程竞争真的会升级为重量级锁吗
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objectmonitor" class="md-nav__link">
    <span class="md-ellipsis">
      ObjectMonitor 监视器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ObjectMonitor 监视器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aqs-fifo-synchronized" class="md-nav__link">
    <span class="md-ellipsis">
      AQS 队列是 FIFO，那 synchronized 的队列呢？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notify-notifyall" class="md-nav__link">
    <span class="md-ellipsis">
      超出认知的 notify 和 notifyAll
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      参考文档
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="synchronized">造火箭从synchronized开始</h1>
<h2 id="synchronized_1">synchronized 原理和对象头</h2>
<h3 id="_1">对象头长什么样子</h3>
<p><img alt="对象头" src="https://qiqiang.oss-cn-hangzhou.aliyuncs.com/muan/objectHeader.jpeg" /></p>
<table>
<thead>
<tr>
<th>原生类型</th>
<th>内存大小（byte）</th>
<th>原生类型</th>
<th>内存大小（byte）</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean</td>
<td>1</td>
<td>byte</td>
<td>1</td>
</tr>
<tr>
<td>short</td>
<td>2</td>
<td>char</td>
<td>2</td>
</tr>
<tr>
<td>int</td>
<td>4</td>
<td>float</td>
<td>4</td>
</tr>
<tr>
<td>long</td>
<td>8</td>
<td>double</td>
<td>8</td>
</tr>
</tbody>
</table>
<pre><code class="language-java">concurrency.ObjectDemo object internals:
OFF  SZ   TYPE DESCRIPTION               VALUE
  0   8        (object header: mark)     0x0000000000000005 (biasable; age: 0)
  8   4        (object header: class)    0xf800c105
 12   4    int ObjectDemo.a              0
 16   2   char ObjectDemo.b              
 18   6        (object alignment gap)    
Instance size: 24 bytes
Space losses: 0 bytes internal + 6 bytes external = 6 bytes total
</code></pre>
<p>代码如下：</p>
<pre><code class="language-xml">
&lt;dependency&gt;
    &lt;groupId&gt;org.openjdk.jol&lt;/groupId&gt;
    &lt;artifactId&gt;jol-core&lt;/artifactId&gt;
    &lt;version&gt;0.16&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<pre><code class="language-java">public class ObjectDemo {
    int a;
    char b;

    public static void main(String[] args) throws InterruptedException, NoSuchFieldException, IllegalAccessException {
        ObjectDemo objectDemo = new ObjectDemo();
        System.out.println(ClassLayout.parseInstance(objectDemo).toPrintable());
    }
}

</code></pre>
<h3 id="_2">升级过程</h3>
<ol>
<li>一个对象默认是无锁或者可偏向无锁状态。</li>
<li>当被某个线程加锁后变为偏向锁状态。</li>
<li>多个线程无竞争交替获取锁，该锁升级为轻量级锁。</li>
<li>一个线程占有锁，其它线程尝试获取该锁，该锁升级为重量级锁。</li>
</ol>
<h2 id="_3">抛出的问题</h2>
<h3 id="hashcode">hashcode 是不是真的在对象头中</h3>
<pre><code class="language-java">public class Example2 {
    public static void main(String[] args) {
        Object lock = new Object();
        System.out.println(&quot;初始状态&quot;);
        System.out.println(ObjectUtils.getMarkWord(lock));
        System.out.println(&quot;调用 hashcode 方法之后&quot;);
        int hashCode = lock.hashCode();
        // 将hashcode转二进制方便对比
        System.out.println(Long.toBinaryString(hashCode));
        System.out.println(ObjectUtils.getMarkWord(lock));
    }
}

public class ObjectUtils {
    private static Unsafe UNSAFE;

    static {
        try {
            Field theUnsafe = Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;);
            theUnsafe.setAccessible(true);
            UNSAFE = (Unsafe) theUnsafe.get(null);
        } catch (NoSuchFieldException | IllegalAccessException e) {
            e.printStackTrace();
        }
    }

    public static String getMarkWord(Object object) {
        long mark = UNSAFE.getLong(object, 0L);
        return CodeUtils.toBinary(mark);
    }
}

public class CodeUtils {
    static final String[] ZERO_RUNS;

    static {
        ZERO_RUNS = new String[16];
        String s = &quot;&quot;;
        for (int c = 0; c &lt; ZERO_RUNS.length; c++) {
            ZERO_RUNS[c] = s;
            s += &quot;0&quot;;
        }
    }

    public static String toHex(long x) {
        String s = Long.toHexString(x);
        int deficit = 16 - s.length();
        return &quot;0x&quot; + ZERO_RUNS[deficit] + s;
    }

    public static String toStandardBinary(long x) {
        String s = Long.toBinaryString(x);
        int zero = 64 - s.length();
        char[] data = new char[zero];
        StringBuilder text = new StringBuilder();
        for (int i = 0; i &lt; data.length; i++) {
            text.append(&quot;0&quot;);
        }
        s = text + s;
        int i = 0;
        StringBuilder builder = new StringBuilder();
        while (i &lt; 64) {
            builder.append(s, i, i += 8).append(&quot; &quot;);
        }
        return builder.toString();
    }

    public static String toBinary(long x) {
        String s = Long.toBinaryString(x);
        int zero = 64 - s.length();
        char[] data = new char[zero];
        StringBuilder text = new StringBuilder();
        for (int i = 0; i &lt; data.length; i++) {
            text.append(&quot;0&quot;);
        }
        s = text + s;
        int i = 0;
        StringBuilder builder = new StringBuilder();
        while (i &lt; 64) {
            builder.append(s, i, i += 8).append(&quot; &quot;);
        }
        return builder.toString();
    }
}
</code></pre>
<p>运行结果如下：</p>
<pre><code class="language-java">00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001 
调用 hashcode 方法之后
10110111101100101011000010010
00000000 00000000 00000000 00010110 11110110 01010110 00010010 00000001 
</code></pre>
<p>可以看到hashcode是<code>10110111101100101011000010010</code>，把对象头中第26位到56位复制出来，去掉空格也是这个数字。
​</p>
<h3 id="_4">初始状态是什么？</h3>
<pre><code class="language-java">public class Example1 {
    public static void main(String[] args) {
        Object lock = new Object();
        System.out.println(&quot;初始状态&quot;);
        System.out.println(ObjectUtils.getMarkWord(lock));;
    }
}
</code></pre>
<p>结果是<code>00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001</code>可以看到这是无锁状态。
因为j vm 偏向锁是延迟4s开启的，那把这个延迟设置为0之后呢？
在 VM 参数里加上<code>-XX:BiasedLockingStartupDelay=0</code>，再次启动，发现结果变了，此时是
<code>00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000101</code>这是一个偏向锁的状态。
所以结论是：锁的初始状态根据偏向锁是否开启和延迟相关，默认是无锁状态。
​</p>
<h3 id="_5">单线程加锁过后是什么样子？</h3>
<p>首先看偏向锁延迟的情况</p>
<pre><code class="language-java">public class Example3 {
    public static void main(String[] args) {
        Object lock = new Object();
        System.out.println(&quot;初始状态&quot;);
        System.out.println(ObjectUtils.getMarkWord(lock));
        synchronized (lock){
            System.out.println(&quot;加锁之后&quot;);
            System.out.println(ObjectUtils.getMarkWord(lock));
        }
        System.out.println(&quot;锁释放之后&quot;);
        System.out.println(ObjectUtils.getMarkWord(lock));
    }
}
</code></pre>
<pre><code class="language-java">00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001 
加锁之后
00000000 00000000 00000000 00000011 00001000 11001010 01001001 11100000 
锁释放之后
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001 
</code></pre>
<p>刚开始是无锁状态，加锁之后变为轻量级锁，释放之后又变为无锁状态。除了锁状态位以外的位置，都是记录的线程栈中Lock
Record锁记录的指针，即<code>11 00001000 11001010 01001001 111000</code>。
​</p>
<p>关闭偏向锁延迟看看。-XX:BiasedLockingStartupDelay=0。</p>
<pre><code class="language-java">00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000101 
加锁之后
00000000 00000000 01111111 11000000 00111101 10000000 10001000 00000101 
锁释放之后
00000000 00000000 01111111 11000000 00111101 10000000 10001000 00000101 
</code></pre>
<p>结果完全不一样了，刚开始的时候是无论什么时候都是偏向锁状态，只是在加锁和释放锁之后 mark word 中都记录了当前<strong>偏向线程的id（前54位）
</strong>。
那这个id是不是真是当前偏向线程的id呢，得找办法看一下。修改代码并关闭偏向锁延迟</p>
<pre><code class="language-java">public class Example4 {
    private static final String command = &quot;jstack %s |grep main&quot;;

    public static void main(String[] args) throws IOException {
        // 打印 Thread Id
        printThreadInfo();
        Object lock = new Object();
        System.out.println(&quot;初始状态&quot;);
        System.out.println(ObjectUtils.getMarkWord(lock));
        Scanner scanner = new Scanner(System.in);
        // 输入线程的16进制id
        String tid = scanner.nextLine();
        String s = Long.toBinaryString(Long.valueOf(tid, 16));
        System.out.println(&quot;从jstack中获取的线程id：&quot;);
        System.out.println(s);
        synchronized (lock) {
            System.out.println(&quot;加锁之后&quot;);
            System.out.println(ObjectUtils.getMarkWord(lock));
        }
        System.out.println(&quot;锁释放之后&quot;);
        System.out.println(ObjectUtils.getMarkWord(lock));
    }

    private static void printThreadInfo() throws IOException {
        String name = ManagementFactory.getRuntimeMXBean().getName();
        System.out.println(name);
        String pid = name.split(&quot;@&quot;)[0];
        System.out.println(&quot;Pid is:&quot; + pid);
        ProcessBuilder processBuilder = new ProcessBuilder();
        processBuilder.command(&quot;bash&quot;, &quot;-c&quot;,String.format(command, pid));
        Process process = processBuilder.start();
        InputStream inputStream = process.getInputStream();
        ByteArrayOutputStream os = new ByteArrayOutputStream();
        IOUtils.copy(inputStream, os);
        System.out.println(new String(os.toByteArray(), StandardCharsets.UTF_8));
    }
}

</code></pre>
<p>运行代码，然后从jps获取当前进程的pid，然后执行命令<code>jstack ${pid}|grep main</code>获取到主线程的16进制id，输入然后回车。</p>
<pre><code class="language-java">Pid is:24248
&quot;main&quot; #1 prio=5 os_prio=31 tid=0x00007fe55580c800 nid=0x2503 runnable [0x000000030dbd0000]
    at concurrency.Example4.main(Example4.java:20)

初始状态
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000101 
00007fe55580c800
从jstack中获取的线程id：
11111111110010101010101100000001100100000000000
加锁之后
00000000 00000000 01111111 11100101 01010101 10000000 11001000 00000101 
锁释放之后
00000000 00000000 01111111 11100101 01010101 10000000 11001000 00000101 
</code></pre>
<p>经过比较，线程id完全一致。
​</p>
<h3 id="_6">交替获取锁升级轻量级锁</h3>
<pre><code class="language-java">public class Example5 {
    static final Object LOCK = new Object();
    static final int COUNT = 10;


    public static void main(String[] args) throws InterruptedException {
//        -XX:BiasedLockingStartupDelay=0
        System.out.println(&quot;加锁前&quot;);
        System.out.println(ObjectUtils.getMarkWord(LOCK));
        TestThread t1 = new TestThread(&quot;t1&quot;);
        TestThread t2 = new TestThread(&quot;t2&quot;);
        t1.other = t2;
        t2.other = t1;
        t1.start();
    }

    static class TestThread extends Thread {
        Thread other;

        public TestThread(String name) {
            super(name);
        }

        @Override
        public void run() {
            for (int i = 0; i &lt; COUNT; i++) {
                synchronized (LOCK) {
                    System.out.println(&quot;线程&quot; + getName() + &quot;获取到锁了&quot;);
                    System.out.println(ObjectUtils.getMarkWord(LOCK));
                }
                if (!other.isAlive()) {
                    other.start();
                } else {
                    LockSupport.unpark(other);
                }
                LockSupport.park();
            }

        }
    }
}
</code></pre>
<pre><code class="language-java">加锁前
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000101 
线程t1获取到锁了
00000000 00000000 01111111 11101100 00011100 10010010 01011000 00000101 
线程t2获取到锁了
00000000 00000000 00000000 00000011 00001111 00100110 01111010 10010000 
线程t1获取到锁了
00000000 00000000 00000000 00000011 00001111 00010110 01001010 10010000 
线程t2获取到锁了
00000000 00000000 00000000 00000011 00001111 00100110 01111010 10010000 
线程t1获取到锁了
00000000 00000000 00000000 00000011 00001111 00010110 01001010 10010000 
线程t2获取到锁了
00000000 00000000 00000000 00000011 00001111 00100110 01111010 10010000 
线程t1获取到锁了
00000000 00000000 00000000 00000011 00001111 00010110 01001010 10010000 
线程t2获取到锁了
00000000 00000000 00000000 00000011 00001111 00100110 01111010 10010000 
线程t1获取到锁了
00000000 00000000 00000000 00000011 00001111 00010110 01001010 10010000 
线程t2获取到锁了
00000000 00000000 00000000 00000011 00001111 00100110 01111010 10010000 
</code></pre>
<p>加锁前是偏向锁，t1获取到锁后锁偏向t1，然后t2又获取到锁了，此时升级为轻量级锁，t1和t2交替获取锁，期间没有发生竞争，锁一直是轻量级锁。</p>
<h3 id="_7">线程竞争真的会升级为重量级锁吗</h3>
<pre><code class="language-java">public class Example6 {

    public static void main(String[] args) throws InterruptedException {
//        -XX:BiasedLockingStartupDelay=0
        Object lock = new Object();
        System.out.println(&quot;加锁前&quot;);
        System.out.println(ObjectUtils.getMarkWord(lock));
        System.out.println(&quot;加锁后&quot;);
        Thread t1 = new Thread(() -&gt; {
            System.out.println(&quot;t1 来抢锁了&quot;);
            synchronized (lock) {
                System.out.println(&quot;t1  加锁了--------&quot;);
                System.out.println(ObjectUtils.getMarkWord(lock));
            }
        });

        synchronized (lock) {
            System.out.println(&quot;main 加锁了--------&quot;);
            System.out.println(ObjectUtils.getMarkWord(lock));
            t1.start();
            // 让 t1 有时间来竞争锁
            Thread.sleep(100);
            System.out.println(ObjectUtils.getMarkWord(lock));
            Thread.sleep(200);
        }
        Thread.sleep(2000);
        System.out.println(&quot;两个线程都释放锁了&quot;);
        System.out.println(ObjectUtils.getMarkWord(lock));
    }
}
</code></pre>
<pre><code class="language-java">加锁前
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000101 
加锁后
main 加锁了--------
00000000 00000000 01111111 11001011 11001011 00000000 10001000 00000101 
t1 来抢锁了
00000000 00000000 01111111 11001011 11001011 00000001 10110011 00111010 
t1  加锁了--------
00000000 00000000 01111111 11001011 11001011 00000001 10110011 00111010 
两个线程都释放锁了
00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001 
</code></pre>
<p>初始状态还是可偏向状态的锁，main 加锁后变为偏向锁，t1
来竞争的时候main还未释放锁，此时锁升级为重量级锁，t1拿到锁之后还是重量级锁（指向同一个监视器），当所有线程都释放锁之后，锁降级为无锁状态。</p>
<h2 id="objectmonitor">ObjectMonitor 监视器</h2>
<p>ObjectMonitor 包含 _<code>WaitSet</code>、<code>_EntryList</code>、<code>_cxq</code>、<code>_owner</code> 和 <code>_recursions</code>。</p>
<ol>
<li>WaitSet。存放 waiting 状态的线程，线程调用 lock.wait() 后会进入这里。</li>
<li>EntryList。调用 synchroized 后会进入这里，获取锁失败后进入 cxq。</li>
<li>cxq。获取锁失败的线程会进入这里，从头部插入。</li>
<li>_owner。存放当前拥有锁的线程。</li>
<li>_recursions。重入次数。</li>
</ol>
<h3 id="aqs-fifo-synchronized">AQS 队列是 FIFO，那 synchronized 的队列呢？</h3>
<pre><code class="language-java">public class SynchronizedExample {
    static List&lt;Thread&gt; list = new ArrayList&lt;&gt;();
    static final Object lock = new Object();

    public static void main(String[] args) throws InterruptedException {
        for (int i = 0; i &lt; 10; i++) {
            Thread t = new Thread(() -&gt; {
                synchronized (lock) {
                    System.out.println(Thread.currentThread().getName() + &quot;--thread executed&quot;);
                    try {
                        TimeUnit.MILLISECONDS.sleep(200);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
            }, &quot;t&quot; + i);
            list.add(t);
        }
        synchronized (lock) {
            for (Thread thread : list) {
                System.out.println(thread.getName() + &quot;-启动顺序--正序0-9&quot;);
                // 此时主线程没有释放锁，线程0-9将会在 EntryList 中
                thread.start();
                TimeUnit.MILLISECONDS.sleep(1);
            }
            System.out.println(&quot;-------执行顺序--正序9-0&quot;);
        }
    }
}
</code></pre>
<p>结果如下：</p>
<pre><code>t0-启动
t1-启动
t2-启动
t3-启动
t4-启动
t5-启动
t6-启动
t7-启动
t8-启动
t9-启动
-------执行顺序--正序9-0
t9--thread executed
t8--thread executed
t7--thread executed
t6--thread executed
t5--thread executed
t4--thread executed
t3--thread executed
t2--thread executed
t1--thread executed
t0--thread executed
</code></pre>
<h3 id="notify-notifyall">超出认知的 notify 和 notifyAll</h3>
<pre><code class="language-java">public class Example8 {
    static final List&lt;Thread&gt; LIST = new ArrayList&lt;&gt;();
    static final List&lt;String&gt; EXECUTED = new ArrayList&lt;&gt;();
    static final Object LOCK = new Object();

    public static void main(String[] args) throws InterruptedException {
        for (int i = 0; i &lt; 10; i++) {
            new Thread(() -&gt; {
                // 因为启动有间隔时间，所以这10个线程不存在竞争，所有的线程都在 waitSet 中
                synchronized (LOCK) {
                    try {
                        System.out.println(Thread.currentThread().getName() + &quot;--等待被唤醒&quot;);
                        // 此时在 cxq 中
                        LOCK.wait();
                        System.out.println(Thread.currentThread().getName() + &quot;醒了----&quot;);
                        EXECUTED.add(Thread.currentThread().getName());
//                        LOCK.notify();
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
            }, &quot;S&quot; + i).start();
            Thread.sleep(10);
        }
        for (int i = 1; i &lt;= 5; i++) {
            LIST.add(new Thread(() -&gt; {
                //11111
                synchronized (LOCK) {
                    System.out.println(Thread.currentThread().getName() + &quot;--thread executed&quot;);
                    try {
                        EXECUTED.add(Thread.currentThread().getName());
                        TimeUnit.MILLISECONDS.sleep(100);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
            }, &quot;t&quot; + i));
        }
        synchronized (LOCK) {
            for (Thread thread : LIST) {
                System.out.println(thread.getName() + &quot;-启动&quot;);
                // 此时主线程没有释放锁，线程1-5加锁失败后会进入 cxq 中, head 5 4 3 2 1
                thread.start();
                TimeUnit.MILLISECONDS.sleep(1);
            }
            System.out.println(&quot;-------执行顺序--正序5-0&quot;);
            // 此时WaitSet 中的线程会移动到 cxq 的头部
            LOCK.notifyAll();
//            LOCK.notify();
        }
        // 此时主线程释放锁，依次从 EntryList
        Thread.sleep(2000);
        System.out.println(EXECUTED);
    }
}
</code></pre>
<pre><code>t0--thread executed
t1-启动
t2-启动
t3-启动
t4-启动
t5-启动
-------执行顺序--正序5-0
t0醒了----
t5--thread executed
t4--thread executed
t3--thread executed
t2--thread executed
t1--thread executed
</code></pre>
<h2 id="_8">参考文档</h2>
<ol>
<li><a href="https://www.infoq.cn/article/e9aqaxqpr76s4kzez7q2">https://www.infoq.cn/article/e9aqaxqpr76s4kzez7q2</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1759447">https://cloud.tencent.com/developer/article/1759447</a></li>
</ol>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tabs", "navigation.expand"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>