import{_ as s,c as i,a,o as t}from"./app-Bc0eL2HD.js";const n={};function d(l,e){return t(),i("div",null,e[0]||(e[0]=[a(`<h1 id="docker-代理服务器配置" tabindex="-1"><a class="header-anchor" href="#docker-代理服务器配置"><span>docker 代理服务器配置</span></a></h1><h2 id="场景" tabindex="-1"><a class="header-anchor" href="#场景"><span>场景</span></a></h2><p>我用 vmware 装了三台虚拟机用于K8s学习，但是拉取镜像时太慢了，查看原因是因为docker无法拉取镜像。然后我有回到宿主机去用docker试了一下，是没有问题的，因为我的宿主机配置了代理。</p><p>那么怎么让虚拟机的网络用到宿主机的代理地址呢？</p><p>查看虚拟机的IP地址，是<code>172.16.213.32</code>，然后查看宿主机同网段的ip地址是<code>172.16.213.1</code>，宿主机代理端口是<code>7890</code>。</p><h2 id="设置dockerd代理" tabindex="-1"><a class="header-anchor" href="#设置dockerd代理"><span>设置dockerd代理</span></a></h2><p>在执行docker pull时，是由守护进程dockerd来执行。 因此，代理需要配在dockerd的环境中。 而这个环境，则是受systemd所管控，因此实际是systemd的配置。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="Copy code" data-copied="Copied"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mkdir</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/systemd/system/docker.service.d</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> touch</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /etc/systemd/system/docker.service.d/proxy.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个proxy.conf文件（可以是任意*.conf的形式）中，添加以下内容：</p><div class="language-conf line-numbers-mode" data-ext="conf" data-title="conf"><button class="copy" title="Copy code" data-copied="Copied"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>[Service]</span></span>
<span class="line"><span>Environment=“HTTP_PROXY=172.16.213.1:7890&quot;</span></span>
<span class="line"><span>Environment=&quot;HTTPS_PROXY=172.16.213.1:7890&quot;</span></span>
<span class="line"><span>Environment=&quot;NO_PROXY=localhost,127.0.0.1&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启生效 代理配置完成后，dockerd代理的修改比较特殊，它实际上是改systemd的配置，因此需要重载systemd并重启dockerd才能生效。使得代理生效：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="Copy code" data-copied="Copied"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> restart</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>检查代理配置：</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="Copy code" data-copied="Copied"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">systemctl</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> show</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --property=Environment</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出如下代理信息，说明代理生效了</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><button class="copy" title="Copy code" data-copied="Copied"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>Environment=HTTPS_PROXY=172.16.213.1:7890 NO_PROXY=localhost,127.0.0.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,16)]))}const o=s(n,[["render",d],["__file","index.html.vue"]]),r=JSON.parse('{"path":"/cloudNative/d3cfc7/","title":"docker 代理服务器配置","lang":"en-US","frontmatter":{"title":"docker 代理服务器配置","createTime":"2023-06-11T13:20:21.000Z","permalink":"/cloudNative/d3cfc7/"},"headers":[],"readingTime":{"minutes":1.18,"words":354},"git":{"updatedTime":1739166395000,"contributors":[{"name":"qiqiang","email":"qiqiang@pingpongx.com","commits":4,"avatar":"https://avatars.githubusercontent.com/qiqiang?v=4","url":"https://github.com/qiqiang"},{"name":"Quince","email":"qiqiangvae@foxmail.com","commits":2,"avatar":"https://avatars.githubusercontent.com/Quince?v=4","url":"https://github.com/Quince"}]},"filePathRelative":"notes/cloudNative/2.docker代理服务器配置.md","bulletin":false}');export{o as comp,r as data};
