import{_ as h,c as k,b as d,d as p,e as l,a as i,r,o as A,f as s}from"./app-CTxld7YN.js";const D={};function g(c,a){const t=r("CodeTabs");return A(),k("div",null,[a[4]||(a[4]=d(`<p>在开发过程中，一旦出现并发问题，那么很可能会产生死锁或者锁等待超时。如果生产环境出现这类问题，那么后果不开设想。 笔者在这里将遇到的一些死锁情况做个汇总记录，方便以后遇到同类问题时可以迅速解决或提供解决思路。</p><h2 id="排查死锁常用命令" tabindex="-1"><a class="header-anchor" href="#排查死锁常用命令"><span>排查死锁常用命令</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="Copy code" data-copied="Copied"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 该命令会返回当前InnoDB引擎的状态信息，其中包含了当前正在等待或者拥有的锁以及被阻塞的事务等信息。</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">SHOW ENGINE INNODB </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">STATUS</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 该命令可以列出当前所有正在运行的进程，包括它们的状态、执行时间、所属用户等信息。</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">SHOW FULL PROCESSLIST;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 该命令可以列出当前所有活跃的事务，包括它们的ID、状态、开始时间等信息。</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> information_schema</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">innodb_trx</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 该命令可以列出当前所有被锁定的对象，包括锁的类型、锁定者、被锁定的表和行等信息。</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> information_schema</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">innodb_locks</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 该命令可以列出当前所有的等待锁的情况，包括请求锁的事务、被请求的锁的类型和状态等信息。</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> information_schema</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">innodb_lock_waits</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="表字段没有加索引导致死锁" tabindex="-1"><a class="header-anchor" href="#表字段没有加索引导致死锁"><span>表字段没有加索引导致死锁</span></a></h2><p>操作一张表的时候，如果查询条件里没有加上索引，mysql 会做全表扫描，在并发环境下，如果有更新操作，那么就会产生</p><h2 id="大批量数据-in-更新死锁" tabindex="-1"><a class="header-anchor" href="#大批量数据-in-更新死锁"><span>大批量数据 in 更新死锁</span></a></h2><p>造数据</p>`,7)),p(t,{id:"19",data:[{id:"建表语句"},{id:"造数据"}]},{title0:l(({value:n,isActive:e})=>a[0]||(a[0]=[i("span",null,"建表语句",-1)])),title1:l(({value:n,isActive:e})=>a[1]||(a[1]=[i("span",null,"造数据",-1)])),tab0:l(({value:n,isActive:e})=>a[2]||(a[2]=[i("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[i("button",{class:"copy",title:"Copy code","data-copied":"Copied"}),i("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"CREATE"),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}}," TABLE"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," `"),i("span",{style:{"--shiki-light":"#59873A","--shiki-dark":"#80A665"}},"t2"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},"`")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},"(")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"    `"),i("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"id"),i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"`"),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}}," int"),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}}," NOT NULL"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"    `"),i("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"c"),i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"`"),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}},"  int"),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}}," DEFAULT"),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}}," NULL"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"    `"),i("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"d"),i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"`"),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}},"  int"),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}}," DEFAULT"),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}}," NULL"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},",")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}},"    PRIMARY KEY"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," ("),i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"`"),i("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"id"),i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"`"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},"),")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"    KEY"),i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"  `"),i("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"c"),i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"`"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," ("),i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"`"),i("span",{style:{"--shiki-light":"#B56959","--shiki-dark":"#C98A7D"}},"c"),i("span",{style:{"--shiki-light":"#B5695977","--shiki-dark":"#C98A7D77"}},"`"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},") ENGINE"),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}},"="),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},"InnoDB;")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1)])),tab1:l(({value:n,isActive:e})=>a[3]||(a[3]=[i("div",{class:"language-sql line-numbers-mode","data-ext":"sql","data-title":"sql"},[i("button",{class:"copy",title:"Copy code","data-copied":"Copied"}),i("pre",{class:"shiki shiki-themes vitesse-light vitesse-dark vp-code"},[i("code",null,[i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"drop"),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}}," procedure"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," createData;")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"create"),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}}," procedure"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," createData"),i("span",{style:{"--shiki-light":"#999999","--shiki-dark":"#666666"}},"()")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"begin")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"    declare"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," i "),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}},"int"),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}}," default"),i("span",{style:{"--shiki-light":"#2F798A","--shiki-dark":"#4C9A91"}}," 0"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},"    label:")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"    while"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},"(i "),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}},"<"),i("span",{style:{"--shiki-light":"#2F798A","--shiki-dark":"#4C9A91"}}," 100000"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},")")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},"        do")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"            insert into"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," t2(id, c, d) "),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"values"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," (i, i, i);")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"            set"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," i "),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}},"="),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," i "),i("span",{style:{"--shiki-light":"#AB5959","--shiki-dark":"#CB7676"}},"+"),i("span",{style:{"--shiki-light":"#2F798A","--shiki-dark":"#4C9A91"}}," 1"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},";")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"        end"),i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}}," while"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," label;")]),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"end"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}},";")]),s(`
`),i("span",{class:"line"}),s(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-light":"#1E754F","--shiki-dark":"#4D9375"}},"call"),i("span",{style:{"--shiki-light":"#393A34","--shiki-dark":"#DBD7CAEE"}}," createData"),i("span",{style:{"--shiki-light":"#999999","--shiki-dark":"#666666"}},"()")])])]),i("div",{class:"line-numbers","aria-hidden":"true",style:{"counter-reset":"line-number 0"}},[i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"}),i("div",{class:"line-number"})])],-1)])),_:1}),a[5]||(a[5]=i("h2",{id:"删除数据时索引字段类型不匹配死锁",tabindex:"-1"},[i("a",{class:"header-anchor",href:"#删除数据时索引字段类型不匹配死锁"},[i("span",null,"删除数据时索引字段类型不匹配死锁")])],-1))])}const E=h(D,[["render",g],["__file","index.html.vue"]]),B=JSON.parse('{"path":"/middleware/mysql/779a1c/","title":"开发过程中mysql死锁排查汇总","lang":"en-US","frontmatter":{"title":"开发过程中mysql死锁排查汇总","createTime":"2022-06-11T09:39:48.000Z","permalink":"/middleware/mysql/779a1c/"},"headers":[],"readingTime":{"minutes":1.68,"words":503},"git":{"updatedTime":1732511545000,"contributors":[{"name":"qiqiang","email":"qiqiang@pingpongx.com","commits":3,"avatar":"https://avatars.githubusercontent.com/qiqiang?v=4","url":"https://github.com/qiqiang"},{"name":"qiqiang","email":"qiqiang","commits":5,"avatar":"https://avatars.githubusercontent.com/qiqiang?v=4","url":"https://github.com/qiqiang"}]},"filePathRelative":"notes/middleware/mysql/30.开发过程中mysql死锁排查汇总.md","bulletin":false}');export{E as comp,B as data};
